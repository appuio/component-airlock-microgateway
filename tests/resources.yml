applications:
  - cilium

parameters:
  kapitan:
    dependencies:
      - type: https
        source: https://raw.githubusercontent.com/appuio/component-openshift4-monitoring/v7.2.0/lib/openshift4-monitoring-prom.libsonnet
        output_path: vendor/lib/prom.libsonnet
      - type: https
        source: https://raw.githubusercontent.com/appuio/component-openshift4-monitoring/v7.2.0/lib/openshift4-monitoring-alert-patching.libsonnet
        output_path: vendor/lib/alert-patching.libsonnet

  airlock_microgateway:
    gateway_parameters:
      airlock/params:
        spec:
          defaults:
            downstream:
              remoteIP:
                proxyProtocol: {}
          kubernetes:
            deployment:
              automountServiceAccountToken: false
              engineContainer: {}
              placement:
                nodeSelector:
                  node-role.kubernetes.io/infra: ""
              replicas: 2
            service:
              annotations:
                k8s.cloudscale.ch/loadbalancer-force-hostname: ingress.mgw.example.com
                k8s.cloudscale.ch/loadbalancer-pool-protocol: proxyv2
              externalTrafficPolicy: Local
              type: LoadBalancer
          logging:
            level: info

    gateway_classes:
      airlock-microgateway:
        parametersRef: airlock/params

    gateways:
      airlock/gateway-1:
        spec:
          gatewayClassName: airlock-microgateway
          listeners:
            - allowedRoutes:
                namespaces:
                  from: All
              name: http
              port: 80
              protocol: HTTP
